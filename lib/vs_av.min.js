define(["exports","vs_utils","vs_core"],function(t,e,i){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;function s(t){this.parent=i.EventSource,this.parent(t),this.constructor=s}s.UNKNOWN_ERR=0,s.MEDIA_ERR_ABORTED=1,s.MEDIA_ERR_NETWORK=2,s.MEDIA_ERR_DECODE=3,s.MEDIA_ERR_SRC_NOT_SUPPORTED=4,s.prototype={delegate:null,_state:i.Task.STOPPED,__audio:null,_src:"",_autoplay:!1,_loop:!1,_volume:1,_muted:!1,_current_time:0,play:function(){if(this._state===i.Task.STARTED)return!1;this.__audio&&(this._state=i.Task.STARTED,this.__audio.play())},start:function(){this.play()},pause:function(){if(this._state===i.Task.PAUSED)return!1;if(this.__audio&&(this.__audio.pause(),this._state=i.Task.PAUSED,this.delegate&&this.delegate.taskDidPause))try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},stop:function(){if(this._state===i.Task.STOPPED)return!1;if(this.__audio&&(window.Media?this.__audio.stop():this.__audio.pause(),this._state=i.Task.STOPPED,this.delegate&&this.delegate.taskDidStop))try{this.delegate.taskDidStop(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},destructor:function(){this.__i__&&(this.__audio.removeEventListener("volumechange",this),this.__audio.removeEventListener("ended",this),this.__audio.removeEventListener("playing",this),this.__audio.removeEventListener("play",this),this.__audio.removeEventListener("pause",this),this.__audio.removeEventListener("error",this),delete this.__audio,this.__audio=null,i.EventSource.prototype.destructor.call(this))},initComponent:function(){i.EventSource.prototype.initComponent.call(this),this.__audio=new window.Audio,this.__audio.preload="auto",this.__audio.autoplay=this._autoplay,this.__audio.addEventListener("volumechange",this),this.__audio.addEventListener("ended",this),this.__audio.addEventListener("playing",this),this.__audio.addEventListener("play",this),this.__audio.addEventListener("pause",this),this.__audio.addEventListener("error",this);var t=this;this.__audio.addEventListener("timeupdate",function(){t._current_time=t.__audio.currentTime,t.outPropertyChange("currentTime")},!1)},handleEvent:function(t){switch(t.type){case"volumechange":this._volume=this.__audio.volume,this.outPropertyChange("volume"),this.propagate("volumechange",this._volume);break;case"ended":if(this._state=i.Task.STOPED,this.delegate&&this.delegate.taskDidEnd)try{this.delegate.taskDidEnd(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}this.propagate(t.type);break;case"pause":if(this._state=i.Task.PAUSED,this.delegate&&this.delegate.taskDidPause)try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}this.propagate(t.type);break;case"playing":case"play":this._state=i.Task.STARTED,this.propagate(t.type);break;case"error":this.__audio.error?this.propagate(t.type,this.__audio.error.code):this.propagate(t.type,s.UNKNOWN_ERR)}}},e.extendClass(s,i.EventSource),e.defineClassProperties(s,{src:{set:function(t){if(e.isString(t)){if(this._src=t,self=this,window.Media){function s(){if(self._state=i.Task.STOPED,self.delegate&&self.delegate.taskDidEnd)try{self.delegate.taskDidEnd(self)}catch(t){t.stack&&console.log(t.stack),console.error(t)}self.propagate(event.type)}this.__audio=new window.Media(this._src,s),this._autoplay&&this.play()}else{if(!this.__audio)return;this.__audio.src=this._src}this.propertyChange("src")}},get:function(){return this._src}},loop:{set:function(t){this._loop=!!t,this.__audio&&(this.__audio.loop=this._loop,this.propertyChange("loop"))},get:function(){return this._loop}},autoplay:{set:function(t){this._autoplay=!!t,this.__audio&&(this.__audio.autoplay=this._autoplay,this.propertyChange("autoplay"))},get:function(){return this._autoplay}},volume:{set:function(t){e.isNumber(t)&&(t<0||t>1||(this._volume=t,this.__audio&&(this.__audio.volume=this._volume,this.propertyChange("volume"))))},get:function(){return this._volume}},muted:{set:function(t){this._muted=!!t,this.propertyChange("muted")},get:function(){return this._muted}},currentTime:{get:function(){return this._current_time}},state:{get:function(){return this._state}}});function o(t){t&&!t.size&&(t.size=[320,200]),this.parent=ui.View,this.parent(t),this.constructor=o}o.UNKNOWN_ERR=0,o.MEDIA_ERR_ABORTED=1,o.MEDIA_ERR_NETWORK=2,o.MEDIA_ERR_DECODE=3,o.MEDIA_ERR_SRC_NOT_SUPPORTED=4,o.prototype={delegate:null,_state:i.Task.STOPPED,__video_node:null,_src:"",_poster:"",_preload:"",_autoplay:!1,_loop:!1,_controls:!1,_volume:1,_muted:!1,_current_time:0,play:function(){if(this._state===i.Task.STARTED)return!1;this.__video_node&&(this._state=i.Task.STARTED,this.__video_node.play())},start:function(){this.play()},pause:function(){if(this._state===i.Task.PAUSED)return!1;if(this.__video_node&&(this.__video_node.pause(),this._state=i.Task.PAUSED,this.delegate&&this.delegate.taskDidPause))try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},stop:function(){if(this._state===i.Task.STOPPED)return!1;if(this.__video_node&&(this.__video_node.stop?this.__video_node.stop():(this.__video_node.pause(),this.__video_node.currentTime=0),this._state=i.Task.STOPPED,this.delegate&&this.delegate.taskDidStop))try{this.delegate.taskDidStop(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},destructor:function(){this.__i__&&(this.__video_node.removeEventListener("volumechange",this),this.__video_node.removeEventListener("ended",this),this.__video_node.removeEventListener("playing",this),this.__video_node.removeEventListener("play",this),this.__video_node.removeEventListener("pause",this),this.__video_node.removeEventListener("error",this),ui.View.prototype.destructor.call(this))},initComponent:function(){if(ui.View.prototype.initComponent.call(this),this.__video_node=this.view.querySelector("video"),this.__video_node){this.__video_node.addEventListener("volumechange",this),this.__video_node.addEventListener("ended",this),this.__video_node.addEventListener("playing",this),this.__video_node.addEventListener("play",this),this.__video_node.addEventListener("pause",this),this.__video_node.addEventListener("error",this);var t=this;this.__video_node.addEventListener("timeupdate",function(){t._current_time=t.__video_node.currentTime,t.outPropertyChange("currentTime")},!1)}else console.error("Uncompatible video view")},handleEvent:function(t){switch(t.type){case"volumechange":this._volume=this.__video_node.getAttribute("volume"),this.outPropertyChange("volume"),this.propagate("volumechange",this._volume);break;case"ended":if(this._state=i.Task.STOPED,this.delegate&&this.delegate.taskDidEnd)try{this.delegate.taskDidEnd(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}this.propagate(t.type);break;case"pause":if(this._state=i.Task.PAUSED,this.delegate&&this.delegate.taskDidPause)try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}this.propagate(t.type);break;case"playing":case"play":this._state=i.Task.STARTED,this.propagate(t.type);break;case"error":this.__video_node.error?this.propagate(t.type,this.__video_node.error.code):this.propagate(t.type,o.UNKNOWN_ERR)}}},e.extendClass(o,ui.View),e.defineClassProperties(o,{controls:{set:function(t){this._controls=!!t,this.__video_node&&(this.__video_node.setAttribute("controls",this._controls),this.propertyChange("controls"))},get:function(){return this._controls}},size:{set:function(t){t&&e.isArray(t)&&2===t.length&&e.isNumber(t[0])&&e.isNumber(t[1])&&(this._size[0]=t[0],this._size[1]=t[1],this.view&&(this._updateSizeAndPos(),this.__video_node||(this.__video_node=this.view.querySelector("video"),this.__video_node)?(this.__video_node.setAttribute("width",this._size[0]),this.__video_node.setAttribute("height",this._size[1])):console.error("Uncompatible video view")))},get:function(){return this.view&&this.view.parentNode&&(this._size[0]=this.view.offsetWidth,this._size[1]=this.view.offsetHeight),this._size.slice()}},src:{set:function(t){e.isString(t)&&(this._src=t,this.__video_node&&(this.__video_node.setAttribute("src",this._src),this.propertyChange("src")))},get:function(){return this._src}},poster:{set:function(t){e.isString(t)&&(this._poster=t,this.__video_node&&(this.__video_node.setAttribute("poster",this._poster),this.propertyChange("poster")))},get:function(){return this._poster}},loop:{set:function(t){this._loop=!!t,this.__video_node&&(this.__video_node.setAttribute("loop",this._loop),this.propertyChange("loop"))},get:function(){return this._loop}},autoplay:{set:function(t){this._autoplay=!!t,this.__video_node&&(this.__video_node.setAttribute("autoplay",this._autoplay),this.propertyChange("autoplay"))},get:function(){return this._autoplay}},volume:{set:function(t){e.isNumber(t)&&(t<0||t>1||(this._volume=t,this.__video_node&&(this.__video_node.setAttribute("volume",this._volume),this.propertyChange("volume"))))},get:function(){return this._volume}},muted:{set:function(t){this._muted=!!t,this.propertyChange("muted")},get:function(){return this._muted}},currentTime:{get:function(){return this._current_time}},state:{get:function(){return this._state}}}),t.Audio=s,t.Video=o,Object.defineProperty(t,"__esModule",{value:!0})});