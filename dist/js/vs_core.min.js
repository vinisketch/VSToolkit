var vs_core=function(t,e,i){"use strict";var n="default"in e?e.default:e,s="default"in i?i.default:i,r=0;function o(){return"vs_id_"+r++}function a(t){this.constructor=a,n.isString(t)?this._id=t:t&&t.id?this._id=t.id:this._id=o(),this.__df__=[],t&&(this.__config__=t)}a.prototype={_id:"",__i__:!1,__input_property__did__change__:!1,__config__:null,__df__:null,init:function(t){if(this.__i__)return this;if(this._id||(this._id=o()),a._obs[this._id]){console.warn("Impossible to create an object with an already used id.");var e=this._id;this._id="vs_id_"+(new Date).getTime()+Math.floor(1e6*Math.random()),console.warn('The id "'+e+'" is replaced by "'+this._id+'".')}return a._obs[this._id]=this,t||this.initComponent(),this.__i__=!0,!t&&this.vsdInit&&this.vsdInit(),this.__config__&&(this.configure(this.__config__),this.__config__=null),this.componentDidInitialize&&this.componentDidInitialize(),this.initSkin&&(console.warn("Your application shouldn't use initSkin anymore.\n        You should rename by componentDidInitialize."),a.prototype.initSkin=function(){},this.initSkin(),a.prototype.initSkin=void 0),this},initComponent:function(){},componentDidInitialize:function(){},createId:function(){return console.warn("this.createId is deprecated, Use the static method vs.core.createId instead"),o()},configure:function(t){if("object"==typeof t){var e,i,n,s=!1;if(this.__df__&&this.__df__.forEach(function(t){t.pausePropagation()}),this.__configuration_process=!0,t instanceof C)if((n=this.getPropertyDescriptor("model"))&&n.set)this.model=t,s=!0;else for(e=t.getModelProperties(),i=0;i<e.length;i++)"id"!==(r=e[i])&&(this[r]=t[r],s=!0);else if(t)for(var r in t)"id"!==r&&"node"!==r&&"node_ref"!==r&&"view"!==r&&(this[r]=t[r],s=!0);this.__configuration_process=!1,this.__df__&&this.__df__.length?this.__df__.forEach(function(t){t.restartPropagation(),s&&t.propagate(this)}):s&&this.propertiesDidChange&&this.propertiesDidChange()}},propertiesDidChange:function(){return!1},toJSON:function(){return this._toJSON()},parseJSON:function(t){try{this.parseData(t&&n.parseJSON(t)||{})}catch(t){t.stack&&console.log(t.stack),console.error("vs.core.Object.parseJSON failed. "+t.toString())}},parseData:function(t){var e,i;for(e in t)i=t[e],this["_"+n.underscore(e)]=i;this.inPropertyDidChange()},_toJSON:function(t){var e,i,s,r={},o=this.getModelProperties();if(!o)return r;for(var a=0;a<o.length;a++)e=o[a],void 0!==(i=this["_"+n.underscore(e)])&&(s=i instanceof Date?'"/Date('+i.getTime()+')/"':i&&i.toJSON?i.toJSON():i,r[e]=s);return r},destructor:function(){delete a._obs[this._id],this.__i__=!1},isDeleted:function(){return!this.__i__},propertyChange:function(t){this.__input_property__did__change__=!0,self=this,this.__df__&&this.__df__.forEach(function(t){t.propagate(self)})},inPropertyDidChange:function(){this.__input_property__did__change__=!0,DataFlow.__nb_propagation>0||this.__configuration_process||this.propertiesDidChange&&this.propertiesDidChange()},outPropertyChange:function(t){this.__input_property__did__change__=!0,self=this,this.__df__&&this.__df__.forEach(function(t){t.propagate(self,!1,!0)})},propagateChange:function(t){this.propertyChange(t)},connect:function(t){return new Connector(this,t)},link:function(t){if(!(t instanceof C))throw"vs.core.Object.link; parameter is not a vs.core.Model";this.__model&&this.__model.unlinkTo(this),this.__model=t,this.__model.linkTo(this),this.configure(this.__model)},unlink:function(){if(this.__model){if(this.__model){this.__model.unlinkTo(this);var t=this.__model.getModelProperties();for(l=t.length,config={};l--;)config[t[l]]=null;this.configure(config)}this.__model=void 0}},clone:function(t,e){var i,s;if(e||(e={}),e[this._id])return e[this._id];if(t||(t={}),t.id||(t.id=o()),!n.isFunction(this.constructor))return console.warn("impossible to clone this object."),null;i=new this.constructor(t),e[this._id]=i;var r=Object.defineProperty?function(t,e,i){var s=e.getOwnPropertyDescriptor(t),r=i.getOwnPropertyDescriptor(t);if(s&&(s.get||s.set))r||(n.defineProperty(i,t,s),i.__properties__||(i.__properties__=[]),i.__properties__.push(t));else{var o=e[t];n.isArray(o)?i[t]=o.slice():i[t]=e[t]}}:function(t,e,i){var s=e.__lookupGetter__(t),r=e.__lookupSetter__(t),o=i.__lookupGetter__(t),a=i.__lookupSetter__(t);if(s&&!o&&i.__defineGetter__(t,s),r&&!a&&i.__defineSetter__(t,r),r||s)i.__properties__||(i.__properties__=[]),i.__properties__.push(t);else{var _=e[t];n.isArray(_)?i[t]=_.slice():i[t]=e[t]}};for(s in this)"parent"!==s&&"_id"!==s&&"constructor"!==s&&0!==s.indexOf("__")&&this.getPropertyDescriptor(s)&&(n.isFunction(this[s])&&!n.isFunction(i[s])?i[s]=this[s]:!i.isProperty(s)&&this.isProperty(s)&&r(s,this,i));return i.__i__=!1,i.init(),this._clone(i,e),this._clone_properties_value(i,e),this.__model&&(e&&e[this.__model._id]?i.link(e[this.__model._id]):i.link(this.__model)),i},_clone_properties_value:function(t,e){var i;for(i in this)"id"!=i&&this.isProperty(i)&&h(i,this,t)},_clone:function(t,e){},getModelProperties:function(){var t=[];return this.__properties__&&(t=t.concat(this.__properties__)),this.constructor.__properties__&&(t=t.concat(this.constructor.__properties__)),t},isProperty:function(t){return!(!this.__properties__||-1===this.__properties__.indexOf(t))||-1!==this.constructor.__properties__.indexOf(t)},defineProperty:function(t,e){n.defineProperty(this,t,e),this.__properties__||(this.__properties__=[]),-1===this.__properties__.indexOf(t)&&this.__properties__.push(t)},getOwnPropertyDescriptor:function(t){return Object.getOwnPropertyDescriptor(this,t)},getPropertyDescriptor:function(t){var e=Object.getOwnPropertyDescriptor(this,t);if(e)return e;return function t(e,i){if(!e)return null;var n=Object.getPrototypeOf(e);if(!n)return null;var s=Object.getOwnPropertyDescriptor(n,i);return s||t(n,i)}(this,t)},_super:function(){var t=this._super.caller._super_func_;t&&t.apply(this,arguments)}},n.defineClassProperty(a,"id",{get:function(){return this._id}});function _(t){return t&&n.isFunction(t.clone)?t.clone():n.clone(t)}var h=Object.defineProperty?function(t,e,i){var s=e.getPropertyDescriptor(t),r=i.getPropertyDescriptor(t),o="_"+n.underscore(t);s&&r&&(s.get||s.set)&&(r.set?i[t]=_(e[o]):i[o]=_(e[o]))}:function(t,e,i){var s=e.__lookupGetter__(t),r=e.__lookupSetter__(t),o=i.__lookupSetter__(t),a="_"+n.underscore(t);(r||s)&&(o?i[t]=_(e[a]):i[a]=_(e[a]))};a._obs={},a.__propertyCloneValue=h;window.navigator.msPointerEnabled,s.POINTER_START,s.POINTER_MOVE,s.POINTER_END,s.POINTER_CANCEL,s.GESTURE_START,s.GESTURE_CHANGE,s.GESTURE_END;var c=function(t,e,i){this.src=t,this.srcTarget=t,this.type=e,this.data=i};c.prototype={src:null,srcTarget:null,type:"",data:null,destructor:function(){delete this.src,delete this.srcTarget,delete this.type,delete this.data}};function u(){}var d=[];u.prototype.configure=function(t,i){this.obj=t,this.func_name=null,this.func_ptr=null,e.isFunction(i)?this.func_ptr=i:e.isString(i)&&(this.func_name=i)},u.retain=function(){return d.length?d.pop():new u},u.release=function(t){d.push(t)};var f=[],p=null,g=[],v=[],S=!1,m=!1,y=!1;function O(t,e){if(t&&e){p={handler_list:e,event:t},T()}}function w(t,i){var n=t.handler_list,s=n.length,r=s,o=s,a=t.event;i?m=!0:S=!0;function _(){--o<=0&&(i?m=!1:S=!1)}function h(t){if(t)try{e.isFunction(t.func_ptr)?t.func_ptr.call(t.obj,a):e.isString(t.func_name)&&e.isFunction(t.obj[t.func_name])?t.obj[t.func_name](a):e.isFunction(t.obj.notify)&&t.obj.notify(a)}catch(t){t.stack?console.error(t.stack):console.error(t)}_()}for(r||_(),r=0;r<s;r++)i?h(n[r]):function(t){E(function(){h(t)})}(n[r])}var E,P;if(window.setImmediate)E=window.setImmediate.bind(window);else{var b=!1;function k(){var t=g;if(b=!1,t.length){g=v,v=t;try{for(var e=0,i=t.length;e<i;e++)t[e].call()}catch(t){t.stack?console.error(t.stack):console.error(t)}t.length=0}}P=window.postMessage?function(){var t="vs.scheduler"+Math.random();function e(e){e.data===t&&k()}return window.addEventListener&&window.addEventListener("message",e,!1),function(){window.postMessage(t,"*")}}():function(){setTimeout(k,0)},window.setImmediate=E=function(t,e){g.push(t),b||(b=!0,P())}.bind(window)}function T(){p&&(w(p,!0),p=null),0===f.length&&0===g.length||y||(S||m?E(t):(g.length&&P(),f.length&&(S||m||w(f.shift()))));function t(){y=!1,T()}}var R="__on_next_frame__";function D(t){this.parent=a,this.parent(t),this.constructor=D,this.__bindings__={},this.__node_binds__={}}D.prototype={__bindings__:null,__node_binds__:null,destructor:function(){var t,e;function i(t){if(t)for(var e,i=t.length;i--;)e=t[i],u.release(e)}for(var n in this.__bindings__)i(this.__bindings__[n]),delete this.__bindings__[n];delete this.__bindings__;for(n in this.__node_binds__)if(void 0!==(e=this.__node_binds__[n]))for(t=0;t<e.length;t++)data=e[t],data.n.removeEventListener(event,data.h);else console.warn("vs.core.Object.destructor, no bind <"+n+" exists.");delete this.__node_binds__,a.prototype.destructor.call(this)},_clone:function(t,e){a.prototype._clone.call(this,t,e),t.__bindings__={},t.__node_binds__={}},bind:function(t,e,i){if(t&&e){var n=u.retain(),s=this.__bindings__[t];return n.configure(e,i),s||(s=[],this.__bindings__[t]=s),s.push(n),n}},unbind:function(t,i,n){!function(t){if(t)for(var s,r=0;r<t.length;)(s=t[r]).obj===i?e.isString(n)||e.isFunction(n)?s.func_name===n||s.func_ptr===n?(t.remove(r),u.release(s)):r++:(t.remove(r),u.release(s)):r++}(this.__bindings__[t])},propagate:function(t,e,i){var n,s=this.__bindings__[t];s&&0!==s.length?(n=new c(this,t,e),i&&(n.srcTarget=i),function(t,e){if(t&&e){var i={handler_list:e,event:t};f.push(i),T()}}(n,s)):this.__parent&&(i||(i=this),this.__parent.propagate(t,e,i))},notify:function(t){this.propagate(t.type,t.data)},nodeBind:function(t,n,s,r){if(t&&e.isString(n)){var o,a,_=this,h=null,c=null;if(void 0===s)s="notify";else if(e.isString(s)){if(!e.isFunction(this[s]))return void console.warn("vs.core.Object.nodeBind, unknown function named: "+s)}else{if(!e.isFunction(s))return void console.error("vs.core.Object.nodeBind, invalid func parameter");s=(h=s).name}c=r&&r!==KEYBOARD.ANY_MASK?function(t){try{if(!r&&(t.altKey||t.ctrlKey||t.shiftKey||t.metaKey))return;if(r===KEYBOARD.ALT&&!t.altKey)return;if(r===KEYBOARD.CTRL&&!t.ctrlKey)return;if(r===KEYBOARD.SHIFT&&!t.shiftKey)return;if(r===KEYBOARD.META&&!t.metaKey)return;t.src=t.currentTarget,t.data=t,h||(h=_[s]),h.call(_,t)}catch(t){t.stack&&console.log(t.stack),console.error(t)}}:function(t){try{t.src=t.currentTarget,t.data=t,h||(h=_[s]),h.call(_,t)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},a=n+s,this.__node_binds__?(void 0===(o=this.__node_binds__[a])&&(o=[],this.__node_binds__[a]=o),o.push({n:t,h:c}),i.addPointerListener(t,n,c,!1)):console.error("nodeBind impossible")}},nodeUnbind:function(t,n,s){if(t&&e.isString(n)){var r,o,a,_;if(void 0===s)s="notify";else if(e.isString(s)){if(!e.isFunction(this[s]))return void console.warn("vs.core.Object.nodeUnbind, unknown function named: "+s)}else{if(!e.isFunction(s))return void console.error("vs.core.Object.nodeBind, invalid func parameter");s=s.name}if(o=n+s,void 0!==(a=this.__node_binds__[o])){for(r=0;r<a.length;)(_=a[r]).n===t?(i.removePointerListener(t,n,_.h,!1),a.remove(r)):r++;t._object_=void 0}else console.warn("vs.core.Object.nodeUnbind, no bind <"+n+","+s+"> exists.")}}},e.extendClass(D,a);var A=1;function x(t){this.dataflow_node=[],this.dataflow_edges={},this.is_propagating=!1,this.__shouldnt_propagate__=0,this._list_node=[],this._edges_from={},t&&t.__df__&&t.__df__.push(this)}x.__nb_propagation=0,x.prototype={propagate_values:function(t){var i,n,s,r,o,a,_=this.dataflow_edges[t._id],h=0,c=0,l=0,u=0,d=0,f=null;if(_)for(u=_.length,h=0;h<u;h++)if((i=_[h])&&(o=i[0])&&(n=i[2])&&n.length)for(c=0;c<n.length;c++){for(f=(r=n[c])[3],a=[],d=(s=r[1]).length,l=0;l<d;l++)a.push(s[l].call(t));if(f&&(a=f.apply(window,a),e.isArray(a)||(a=[a])),d=(s=r[2]).length,a.length!==d)return void console.error("Dataflow, invalid parameters");for(l=0;l<d;l++)s[l].call(o,a[l]);o.__input_property__did__change__=!0}},propagate:function(t,e,i){if(!this.is_propagating&&!this.__shouldnt_propagate__){this.is_propagating=!0,x.__nb_propagation++;var n=0,s=this.dataflow_node,r=s.length;if(t){for(;n<r&&s[n]!==t;)n++;if(n<r-1){if(!i&&t.propertiesDidChange&&t.propertiesDidChange())return x.__nb_propagation--,void(this.is_propagating=!1);this.propagate_values(t),n++}else n=0}for(;n<r;n++)if((t=s[n])&&t.__input_property__did__change__){if(t.__input_property__did__change__=!1,t.propertiesDidChange&&t.propertiesDidChange())continue;this.propagate_values(t)}x.__nb_propagation--,this.is_propagating=!1}},connect:function(t,i,n,s,r){var o,_,h,c,l,u,d,f,p,g,v=A++;if(o=e.isString(t)?t:t._id,t=a._obs[o]){if(-1===t.__df__.indexOf(this)&&t.__df__.push(this),_=e.isString(n)?n:n._id,e.isString(i))h=[i];else{if(!e.isArray(i))return void console.warn("DataFlow.connect, error");h=i}if(e.isString(s))c=[s];else{if(!e.isArray(s))return void console.warn("DataFlow.connect, error");c=s}if(r||c.length===h.length){for(-1===this._list_node.indexOf(o)&&this._list_node.push(o),-1===this._list_node.indexOf(_)&&this._list_node.push(_),(l=this._edges_from[o])||(l=[],this._edges_from[o]=l),d=l.length,u=0;u<d;u++)if((f=l[u])[0]===_){p=f[2];break}return p||(p=[],l.push([_,1,p])),g=[v,h.slice(),c.slice(),r],p.push(g),v}console.warn("DataFlow.connect, error")}},unconnect:function(){1===arguments.length?this._unconnect_by_id(arguments[0]):this._unconnect_by_params.apply(this,arguments)},_unconnect_by_params:function(t,i,n,s){var r,o,_,h,c,l,u,d;A++;if(r=e.isString(t)?t:t._id,(c=this._edges_from[r])&&(t=a._obs[r])&&-1!==t.__df__.indexOf(this)){if(o=e.isString(n)?n:n._id,e.isString(i))_=[i];else{if(!e.isArray(i))return void console.warn("DataFlow.unconnect, error");_=i}if(e.isString(s))h=[s];else{if(!e.isArray(s))return void console.warn("DataFlow.unconnect, error");h=s}for(l=0;l<c.length;l++)if((u=c[l])[0]===o){d=u[2];for(var f,p=0;p<d.length;)f=d[p],properties_out_s=f[1],properties_in_s=f[2],g(properties_out_s,_),g(properties_in_s,h),0===properties_out_s.length||0===h.length?d.remove(p):p++;0===d.length?c.remove(l):l++}else l++}function g(t,e){e.forEach(function(e){var i=t.indexOf(e);-1!==i&&t.remove(i)})}},_unconnect_by_id:function(t){for(var e in this._edges_from){var i=this._edges_from[e];if(i)for(var n=i.length,s=0;s<n;s++)for(var r,o=i[s][2],a=0,_=o.length;a<_;a++)if((r=o[a])&&r[0]===t)return void o.remove(a)}},_sort:function(){var t,e,i,n,s=this._list_node.length,r=[];for(t=0;t<s;t++)r[t]=0;for(i in this._edges_from)for(n=this._edges_from[i],e=0;e<n.length;e++)r[this._list_node.findItem(n[e][0])]++;for(var o=this._list_node.slice(),a=[],_=0;0!==o.length;){var h=this._array_min(r),c=r[h];r.remove(h);var l=o[h];if(o.remove(h),c>0&&_++,a.push(l),n=this._edges_from[l])for(e=0;e<n.length;e++){var u=o.findItem(n[e][0]);-1!==u&&r[u]--}}if(this._list_node=a,this.is_sorted=!0,this.is_cyclic=_>0,_>0){var d=Object.keys(this._edges_from).length;console.warn("WARNING: Cycles detected during topological sort.%d dependencies out of %d have been violated.\n",_,d)}return!this.is_cyclic},_array_min:function(t){var e=t.length;if(0===e)return-1;if(1===e)return 0;for(var i=0,n=t[i],s=1;s<t.length;s++)t[s]<n&&(n=t[s],i=s);return i},build:function(){this._sort(),this._data_optimize(this._edges_from,this._list_node)},pausePropagation:function(){this.__shouldnt_propagate__++},restartPropagation:function(){this.__shouldnt_propagate__--,this.__shouldnt_propagate__<0&&(this.__shouldnt_propagate__=0)},_data_optimize:function(t,i){if(i&&t){var n,s,r,o,_,h,c,l,u,d,f,p,g,v,S,m,y,O,w,E=[];for(n=0;n<i.length;n++)p=i[n],(v=a._obs[p])&&E.push(v);this.dataflow_node=E,E={};for(p in t)if((v=a._obs[p])&&(o=t[p],_=[],E[p]=_,o))for(n=0;n<o.length;n++)if(h=o[n],c=[3],_.push(c),g=h[0],S=a._obs[g])for(c[0]=S,c[1]=h[1],l=h[2],u=[],c[2]=u,s=0;s<l.length;s++){for(d=l[s],f=[4],u.push(f),f[0]=d[0],e.isFunction(d[3])&&(f[3]=d[3]),O=d[1],w=[],r=0;r<O.length;r++)m=O[r],(y=v.getPropertyDescriptor(m))&&(y.get?w.push(y.get):w.push(function(t){return function(){return this[t]}}("_"+e.underscore(m))));for(f[1]=w,O=d[2],w=[],r=0;r<O.length;r++)m=O[r],(y=S.getPropertyDescriptor(m))&&(y.set?w.push(y.set):w.push(function(t){return function(e){this[t]=e}}("_"+e.underscore(m))));f[2]=w}this.dataflow_edges=E}}},x._default_df_=new x;function C(t){this.parent=D,this.parent(t),this.constructor=C,this.__links__=[]}C.prototype={__links__:null,__should_propagate_changes__:!0,_sync_service_:null,bindChange:function(t,e,i){e&&this.bind(t?"change:"+t:"change",e,i)},unbindChange:function(t,e,i){this.unbind(t?"change:"+t:"change",e,i)},stopPropagation:function(){this.__should_propagate_changes__=!1},hasToPropagateChange:function(){return this.__should_propagate_changes__},change:function(t,e,i){var n;this.__should_propagate_changes__=!0,n=new c(this,t=t?"change:"+t:"change",e);try{if(!i)for(var s=this.__links__.length;s--;)this.__links__[s].configure(this);"change"!==t&&O(n,this.__bindings__[t]),O(n,this.__bindings__.change)}catch(t){t.stack&&console.error(t.stack),console.error(t)}},clear:function(t){var i,n=this;this.getModelProperties().forEach(function(s){i="_"+e.underscore(s),t&&e.free(n[i]),n[i]=void 0})},propagate:function(t,e,i){this.__should_propagate_changes__=!0,D.prototype.propagate.call(this,t,e,i)},linkTo:function(t){t instanceof a&&-1===this.__links__.indexOf(t)&&this.__links__.push(t)},unlinkTo:function(t){t instanceof a&&this.__links__.remove(t)},propertyChange:function(t){if(x._default_df_&&x._default_df_.propagate(this,t),this.__should_propagate_changes__){var e=this.__links__.length;if(t)for(;e--;)this.__links__[e][t]=this[t];else for(;e--;)this.__links__[e].configure(this);this.change(null,null,!0)}},parseData:function(t){var e;this.stopPropagation();for(e in t)this._parse_property(e,t[e]);this.change()},_parse_property:function(t,i){var n,s,r=this.getModelProperties(),o="_"+e.underscore(t);i&&i.data||e.isArray(i)?(s=new VSArray({id:i.id}).init()).parseData(i):s=i,-1===r.indexOf(t)&&(n={},o="_"+e.underscore(t),n.set=(_=t,h=o,function(t){this[h]=t,this.propertyChange(_)}),n.get=(a=o,function(){return this[a]}),this.defineProperty(t,n));var a,_,h;this[o]=s}},e.extendClass(C,D);var N=Object.prototype.constructor;function I(t){var i=null,n={},s=a,r={};if(i=function(){this.parent=i.__spec.parent,i.__spec&&i.__spec._constructor?i.__spec._constructor.apply(this,arguments):i.__spec&&i.__spec.parent&&this.parent.apply(this,arguments),this.constructor=i},t&&t.parent&&(s=t.parent,delete t.parent),t&&t.properties&&(r=t.properties,delete t.properties),n.parent=s,t&&t.constructor&&t.constructor!==N&&(n._constructor=t.constructor,n._constructor._super_func_=s),i.__spec=n,t&&(i.prototype=t,t.constructor=i),s.prototype&&e.extendClass(i,s),t)for(var o in t)if(t.hasOwnProperty(o)){var _=t[o],h=s.prototype[o];e.isFunction(_)&&e.isFunction(h)&&(_._super_func_=h)}return function(t,i){var n,s,r,o={};for(var _ in i){var h=i[_];if(e.isNumber(h))n=h,s={},r="_"+e.underscore(_),n&a.PROPERTY_IN&&(s.set=function(t,e){return function(i){this[e]=i,this.propertyChange(t)}}(_,r)),n&a.PROPERTY_OUT&&(s.get=function(t){return function(){return this[t]}}(r));else if(e.isString(h)){var c=W.exec(h);if(!c||3!=c.length)throw"Unvalid property path: "+h;(s={}).set=function(t,e){return function(i){for(var n=this,s=t.split(".");n&&s.length;)n=n[s.shift()];n&&(n[e]=i),this.propertyChange(e)}}(c[1],c[2]),s.get=function(t,e){return function(){for(var i=this,n=t.split(".");i&&n.length;)i=i[n.shift()];if(i)return i[e]}}(c[1],c[2])}else"object"==typeof h&&(s=h);o[_]=s}e.defineClassProperties(t,o)}(i,r),i}a.PROPERTY_IN=1,a.PROPERTY_OUT=2,a.PROPERTY_IN_OUT=3;var W=/(\w+[.\w+]*)#(\w+)/;var F=I({parent:D,_url:"",_clb_param_name:"callback",__index:0,properties:{url:{set:function(t){e.isString(t)&&(this._url=t)}},clbParamName:{set:function(t){e.isString(t)&&(this._clb_param_name=t)}},responseJson:{get:function(){return this._response_json}}},send:function(){var t=this,i="jsonp"+t._id+t.__index++,n=this._clb_param_name+"="+i,s=t._url,r=s.length-1;"?"===s[r]?s+=n:"-1"!==s.indexOf("?")?s+="&"+n:"/"===s[r]?s=s.substr(0,r)+"?"+n:s+="?"+n;var o=e.importFile(s,null,null,"js"),a=function(){o&&(o.parentElement.removeChild(o),o=void 0)},_=setTimeout(function(){a(),i in window&&delete window[i],t.propagate("loaderror","Impossible to load data")},3e3);window[i]=function(e){clearTimeout(_),a(),delete window[i],e&&(e.error?t.propagate("loaderror",e.error):(t._response_json=e,t.outPropertyChange(),t.propagate("jsonload",e)))}}});function M(t){this.parent=C,this.parent(t),this.constructor=M}M.prototype={_data:null,_model_class:null,_index:null,_value:null,initComponent:function(){this._data=[],this.forEach=Array.prototype.forEach.bind(this._data)},forEach:function(){},item:function(t){if(e.isNumber(t)&&!(t<0||t>this._data.length))return this._data[t]},_instanciateModel:function(t){if(t instanceof C)return t;if(t instanceof Object&&this._model_class)try{var e=new this._model_class(t);return e.init(),e}catch(t){t.stack&&console.log(t.stack),console.error(t)}return t},add:function(){for(var t=[],e=0;e<arguments.length;e++)t.push(this._instanciateModel(arguments[e]));return this._data.push.apply(this._data,t),this.hasToPropagateChange()&&this.change("add"),this.length},addAtIndex:function(){if(!(arguments.length<2)){for(var t=[],e=1;e<arguments.length;e++)t.push(this._instanciateModel(arguments[e]));this._data.splice.apply(this._data,t),this.hasToPropagateChange()&&this.change("add",{from:t[0],to:t.length-2})}},remove:function(t,e){this._data.remove(t,e),this.hasToPropagateChange()&&this.change("remove",{from:t,to:e})},removeAll:function(){this._data=[],this._index=-1,this._value=void 0,this.forEach=Array.prototype.forEach.bind(this._data),this.hasToPropagateChange()&&this.change("removeall")},clear:function(t){var i=0,n=this._data.length;if(t)for(;i<n;i++)e.free(this._data[i]);this.removeAll()},indexOf:function(){throw"method not yet implemented"},toJSON:function(){var t,e=this._toJSON(),i=0,n=this._data.length;for(e.data=[];i<n;i++)void 0!==(t=this._data[i])&&(t instanceof Date?t='"/Date('+t.getTime()+')/"':t&&t.toJSON&&(t=t.toJSON()),e.data.push(t));return e},parseData:function(t){var i,n,s,r,o=this;this.stopPropagation();function a(t){for(o._data=[],o.forEach=Array.prototype.forEach.bind(o._data),i=0;i<t.length;i++)r=t[i],(s=o._model_class?(new o._model_class).init():e.isArray(r)?(new M).init():e.isUndefined(r)||e.isString(r)||e.isNumber(r)||"boolean"==typeof r||null==r||r instanceof Date?null:(new C).init())?(s.parseData(r),o.add(s)):o.add(r)}if(e.isArray(t))a(t);else for(n in t)"data"==n?a(t.data):this._parse_property(n,t[n]);this.change()}},e.extendClass(M,C),e.defineClassProperties(M,{data:{set:function(t){if(!this.__i__)throw"Component not initialized";if(e.isArray(t))this._data=t.slice(),this.forEach=Array.prototype.forEach.bind(this._data);else{if(!(t instanceof M))return;this._data=t._data.slice(),this.forEach=Array.prototype.forEach.bind(this._data)}this.hasToPropagateChange()&&this.change("add")},get:function(){if(!this.__i__)throw"Component not initialized";return this._data.slice()}},length:{get:function(){if(!this.__i__)throw"Component not initialized";return this._data.length}},modelClass:{set:function(t){e.isFunction(t)&&(this._model_class=t)}},index:{set:function(t){e.isString(t)&&(t=parseInt(t,10)),e.isNumber(t)&&(t<0||t>this._data.length||(t=Math.floor(t),this._index=t,this._value=this._data[t],this.propertyChange("value")))},get:function(){return this._index}},value:{get:function(){return this._value}}});var j=function(t,e){this._base_object=t,this._previous_object=void 0,this.property_out=e};j.prototype.to=function(t,e,i){return x._default_df_.connect(this._base_object,this.property_out,t,e,i),this._previous_object=t,this},j.prototype.connect=function(t){var e=this._previous_object||this._base_object;return new j(e,t)};function K(t){this.parent=D,this.parent(t),this.constructor=K,this.__models__={}}K.prototype={__models__:null,registerModel:function(t,e){t&&e&&(this.__models__[t]&&error.log("Model with the name already registered."),this.__models__[t]=e,e._sync_service_=this)},removeModel:function(t){t&&this.__models__[t]&&delete this.__models__[t]},save:function(t){},load:function(t){}},e.extendClass(K,D);function G(){this.orientation=null,this.deviceId=null,this.browserDetect(),this.orientationDetect(),this.screenDetect()}G.OS_UNKNOWN=0,G.OS_WINDOWS=1,G.OS_MACOS=2,G.OS_LINUX=4,G.OS_IOS=5,G.OS_WP7=6,G.OS_BLACK_BERRY=7,G.OS_SYMBIAN=8,G.OS_ANDROID=9,G.OS_MEEGO=10,G.OS_FIREFOX=11,G.SR_UNKNOWN=0,G.SR_QVGA=1,G.SR_WQVGA=2,G.SR_HVGA=4,G.SR_VGA=5,G.SR_WVGA=6,G.SR_FWVGA=7,G.SR_SVGA=8,G.SR_DVGA=9,G.SR_WDVGA=10,G.SR_XGA=11,G.SR_N_HD=12,G.SR_Q_HD=13,G.SR_WXGA=14,G.SR_QXGA=15,G.BROWSER_UNKNOWN=0,G.BROWSER_CHROME=1,G.BROWSER_SAFARI=2,G.BROWSER_OPERA=3,G.BROWSER_FIREFOX=4,G.BROWSER_MSIE=5,G.SS_UNKNOWN=0,G.SS_4_INCH=1,G.SS_7_INCH=2,G.SS_10_INCH=3,G.prototype={os:G.OS_UNKNOWN,browser:G.BROWSER_UNKNOWN,screenResolution:G.SR_UNKNOWN,screenRatio:0,screenSize:G.SS_UNKNOWN,virtualScreenSize:null,browserDetect:function(){function t(t){for(var e=t.length;e--;){var i=t[e].string,n=t[e].prop;if(i){if(i.match(t[e].subString))return t[e].identity}else if(n)return t[e].identity}}this.browser=t(G._data_browser)||G.BROWSER_UNKNOWN,this.os=t(G._data_OS)||G.OS_UNKNOWN},orientationDetect:function(){window.orientation?this.orientation=window.orientation:window.outerWidth>window.outerHeight?this.orientation=90:this.orientation=0},_getScreenSize:function(){return window.device&&window.device.width?[window.device.width,window.device.height]:this.os>=G.OS_IOS&&this.os<=G.OS_MEEGO?[window.screen.width,window.screen.height]:[window.outerWidth,window.outerHeight]},screenDetect:function(){var t,e=window.devicePixelRatio;if(e||(e=1),(t=this._getScreenSize())[0]>t[1]){var i=t[0];t[0]=t[1],t[1]=i}this.screenResolution=G._getScreenResolutionCode(t[0],t[1]),this.screenRatio=t[1]/t[0];var n=160*e;window.device&&window.device.dpi&&(n=device.dpi);var s=Math.sqrt(t[0]*t[0]+t[1]*t[1])/n;s<6?this.screenSize=G.SS_4_INCH:s<9?this.screenSize=G.SS_7_INCH:s<11&&(this.screenSize=G.SS_10_INCH)},getOrientation:function(){return this.orientation},setDeviceId:function(t){e.isString(t)&&(this.screenResolution=G.SR_UNKNOWN,this.deviceId=t,-1!=t.indexOf("wp7")?(this.os=G.OS_WP7,this.screenResolution=G.SR_WVGA,this.screenRatio=1.6,this.screenSize=G.SS_4_INCH):-1!=t.indexOf("iphone")?(this.os=G.OS_IOS,this.screenResolution=G.SR_HVGA,-1!=t.indexOf("_3_2")?this.screenRatio=1.5:-1!=t.indexOf("_16_9")&&(this.screenRatio=16/9),this.screenSize=G.SS_4_INCH):-1!=t.indexOf("ipad")?(this.os=G.OS_IOS,this.screenResolution=G.SR_XGA,this.screenRatio=4/3,this.screenSize=G.SS_10_INCH):-1!=t.indexOf("ffos")?this.os=G.OS_FIREFOX:-1!=t.indexOf("android")&&(this.os=G.OS_ANDROID,-1!=t.indexOf("_3_2")?this.screenRatio=1.5:-1!=t.indexOf("_16_10")?this.screenRatio=1.6:-1!=t.indexOf("_16_9")&&(this.screenRatio=16/9),-1!=t.indexOf("android_4")?this.screenSize=G.SS_4_INCH:-1!=t.indexOf("android_7")?this.screenSize=G.SS_7_INCH:-1!=t.indexOf("android_10")&&(this.screenSize=G.SS_10_INCH)))},generateDeviceId:function(t){if(t&&this.deviceId)return this.deviceId;this.orientationDetect(),this.screenDetect();var e="";switch(this.os){case G.OS_IOS:screenSize=this._getScreenSize(),320!==screenSize[0]&&480!==screenSize[0]||(e+="iphone"),640!==screenSize[0]&&960!==screenSize[0]||(e+="iphone"),768!==screenSize[0]&&1024!==screenSize[0]||(e+="ipad"),1536!==screenSize[0]&&2048!==screenSize[0]||(e+="ipad");break;case G.OS_ANDROID:e+="android";break;case G.OS_FIREFOX:e+="ffos";break;case G.OS_WP7:e+="wp7";break;case G.OS_BLACK_BERRY:e+="blackberry"}switch(this.screenSize){case G.SS_4_INCH:e+="_3";break;case G.SS_7_INCH:e+="_7";break;case G.SS_10_INCH:e+="_10"}switch(Math.abs(window.deviceConfiguration.screenRatio-1.5)<.1?e+="_3_2":Math.abs(window.deviceConfiguration.screenRatio-4/3)<.1?e+="_4_3":Math.abs(window.deviceConfiguration.screenRatio-1.6)<.1?e+="_16_10":Math.abs(window.deviceConfiguration.screenRatio-16/9)<.1&&(e+="_16_9"),this.orientation){case 90:case-90:e+="_l";break;case 0:case 180:e+="_p"}return e},setOrientation:function(t,e){var i,n,s,r,o=window.innerWidth,_=window.innerHeight;o>_&&(r=_,_=o,o=r);for(n in a._obs)(s=a._obs[n])&&(s._orientationWillChange&&s._orientationWillChange(t),s.orientationWillChange&&s.orientationWillChange(t));this.targetId&&(i=(i=this.targetId.replace("_p","")).replace("_l",""),i+=0===t||180===t?"_p":"_l",this.targetId=i,this.setActiveStyleSheet(this.targetId)),this.orientation=t,this.virtualScreenSize&&cordova&&cordova.exec&&cordova.exec(null,null,"VSD_Application","setAppSize",[{width:this.virtualScreenSize[0],height:this.virtualScreenSize[1]}]);var h=function(){var e,i;for(e in a._obs)(i=a._obs[e])&&i.orientationDidChange&&i.orientationDidChange(t)};e?h.call(this):setTimeout(h,100)},setActiveStyleSheet:function(t){e.setActiveStyleSheet(t)},registerTargetId:function(t,e){}},G._getScreenResolutionCode=function(t,e){return t*=window.devicePixelRatio,e*=window.devicePixelRatio,240===t&&320===e?G.SR_QVGA:240===t&&400===e?G.SR_WQVGA:320===t&&480===e?G.SR_HVGA:480===t&&640===e?G.SR_VGA:480===t&&800===e?G.SR_WVGA:320===t&&854===e?G.SR_WFVGA:600===t&&800===e?G.SR_SVGA:640===t&&960===e?G.SR_DVGA:640===t&&1136===e?G.SR_WDVGA:768===t&&1024===e?G.SR_XGA:360===t&&640===e?G.SR_N_HD:540===t&&960===e?G.SR_Q_HD:720===t&&1280===e?G.SR_WXGA:768===t&&1280===e?G.SR_WXGA:800===t&&1280===e?G.SR_WXGA:1536===t&&2048===e?G.SR_QXGA:void 0},G._estimateScreenSize=function(t){var e=t.width/t.xdpi,i=t.height/t.ydpi,n=Math.sqrt(e*e+i*i);return n<5?3:n<8?7:10},"undefined"!=typeof navigator?G._data_browser=[{string:navigator.userAgent,subString:"Chrome",identity:G.BROWSER_CHROME},{string:navigator.vendor,subString:"Apple",identity:G.BROWSER_SAFARI,versionSearch:"Version"},{prop:window.opera,identity:G.BROWSER_OPERA,versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:G.BROWSER_FIREFOX},{string:navigator.userAgent,subString:"MSIE",identity:G.BROWSER_MSIE,versionSearch:"MSIE"}]:G._data_browser=[],"undefined"!=typeof navigator?G._data_OS=[{string:navigator.platform,subString:"Win",identity:G.OS_WINDOWS},{string:navigator.platform,subString:"Mac",identity:G.OS_MACOS},{string:navigator.platform,subString:"Linux",identity:G.OS_LINUX},{string:navigator.userAgent,subString:"iPad|iPhone|iPod",identity:G.OS_IOS},{string:navigator.userAgent,subString:"Android",identity:G.OS_ANDROID},{string:navigator.userAgent,subString:"Firefox",identity:G.OS_FIREFOX}]:G._data_OS=[],"undefined"==typeof window||window.deviceConfiguration||(window.deviceConfiguration=new G);var U=function(t){this.parent=EventSource,this.parent(o()),this.constructor=U,this.owner=t,this._list_of_state={},this._list_input=new Array,this._list_output=new Array,this._initial_state="",this._current_state="",this._inputs={},this._output_action={}};U.prototype={destructor:function(){delete this._list_of_state,this.owner=void 0,delete this._list_of_state,delete this._list_input,delete this._list_output,delete this._inputs,delete this._output_action,EventSource.prototype.destructor.call(this)},_clone:function(t,e){EventSource.prototype._clone.call(this,t,e),t.owner=t.__config__.owner,t._current_state="",t._inputs={},t._output_action={}},initWithData:function(t,e,i,n){if(t&&e&&i&&n){for(var s=0;s<t.length;s++)this.addState(t[s]);for(s=0;s<e.length;s++)this.addInput(e[s]);for(s=0;s<i.length;s++)this.addOutput(i[s]);for(s=0;s<n.length;s++)this.addTransition(n[s].from,n[s].to,n[s].on,n[s].output)}},initWithMatrix:function(t){for(var e=1;e<t[0].length;e++)this.addState(t[0][e]);for(e=1;e<t.length;e++)for(var i=t[e][0],n=1;n<t[0].length;n++){var s=t[0][n],r=t[e][n];if(r){var o=r.split("/");o[0]&&this.addInput(o[0]),o[1]&&this.addOutput(o[1]),this.addTransition(i,s,o[0],o[1])}}},addInput:function(t){t&&!this.existInput(t)&&this._list_input.push(t)},getInputs:function(){return this._list_input.slice()},existInput:function(t){if(t)return this._list_input.findItem(t)>-1},addOutput:function(t){t&&!this.existOutput(t)&&this._list_output.push(t)},getOutputs:function(){return this._list_output.slice()},existOutput:function(t){if(t)return this._list_output.findItem(t)>-1},addState:function(t){if(!t||this.existState(t))return!1;var e={};return e.transitionEvents={},this._list_of_state[t]=e,!0},removeState:function(t){return!(!t||!this.existState(t))&&(delete this._list_of_state[t],!0)},renameState:function(t,e){if(!t||!this.existState(t))return!1;if(!e||this.existState(e))return!1;this._list_of_state[e]=this._list_of_state[t],delete this._list_of_state[t],this._initial_state===t&&(this._initial_state=e);for(var i in this._list_of_state){var n=this._list_of_state[i];if(null!==n)for(var s in n.transitionEvents){var r=n.transitionEvents[s];r.to===t&&(r.to=e)}}return!0},getListState:function(){var t=[];for(var e in this._list_of_state)t.push(e);return t},existState:function(t){return!!t&&!!this._list_of_state[t]},addTransition:function(t,e,i,n){if(t&&this.existState(t)&&e&&this.existState(e)&&i&&this.existInput(i)){var s={on:i,to:e,output:n};this._list_of_state[t].transitionEvents[i]=s}},removeTransitionFrom:function(t,e){if(t&&this.existState(t)&&e&&this.existInput(e)){var i=this._list_of_state[t];i.transitionEvents[e]&&delete i.transitionEvents[e]}},removeTransitionTo:function(t,e){if(t&&this.existState(t)&&e&&this.existInput(e))for(var i in this._list_of_state){var n=this._list_of_state[i],s=n.transitionEvents[e];s&&s.to===t&&delete n.transitionEvents[e]}},getTransionsToState:function(t){if(this.existState(t)){var i=[];for(var n in this._list_of_state){var s=this._list_of_state[n];if(null!==s)for(var r in s.transitionEvents){var o=s.transitionEvents[r];if(o.to===t){var a=e.clone(o);a.from=n,i.push(a)}}}return i}},getTransionsFromState:function(t){if(this.existState(t)){var i=[],n=this._list_of_state[t];if(null===n)return null;for(var s in n.transitionEvents){var r=n.transitionEvents[s],o=e.clone(r);o.from=t,i.push(o)}return i}},switchStates:function(t,e){if(t!==e&&this.existState(t)&&this.existState(e)){for(var i=this.getTransionsToState(t),n=this.getTransionsFromState(t),s=this.getTransionsToState(e),r=this.getTransionsFromState(e),o=0;o<i.length;){(a=i[o]).from===e?i.remove(a):o++}for(o=0;o<n.length;){(a=n[o]).to===e?n.remove(a):o++}for(o=0;o<i.length;o++){var a=i[o];this.removeTransitionFrom(a.from,a.on)}for(o=0;o<n.length;o++){a=n[o];this.removeTransitionFrom(a.from,a.on)}for(o=0;o<s.length;o++){a=s[o];this.removeTransitionFrom(a.from,a.on)}for(o=0;o<r.length;o++){a=r[o];this.removeTransitionFrom(a.from,a.on)}for(o=0;o<i.length;o++){var _=(a=i[o]).from===e?t:a.from;this.addTransition(_,e,a.on,a.output)}for(o=0;o<n.length;o++){var h=(a=n[o]).from===e?t:a.to;this.addTransition(e,h,a.on,a.output)}for(o=0;o<s.length;o++){_=(a=s[o]).from===t?e:a.from;this.addTransition(_,t,a.on,a.output)}for(o=0;o<r.length;o++){h=(a=r[o]).to===t?e:a.to;this.addTransition(t,h,a.on,a.output)}this._initial_state===t?this._initial_state=e:this._initial_state===e&&(this._initial_state=t)}},setInput:function(t,e,i){if(t&&e&&i){if(e.bind)e.bind(i,this);else{if(!e.addEventListener)return;this.nodeBind(e,i)}var n=this._inputs[e];n||(n=[],this._inputs[e]=n),n.push([i,t,e])}},setOutput:function(t,e){t&&e&&(this._output_action[t]=e)},activate:function(){return!(!this._initial_state||!this._list_of_state[this._initial_state])&&(this.goTo(this._initial_state),!0)},goTo:function(t,e,i){if(!this.existState(t))return!1;if(this._current_state&&this._list_of_state[this._current_state],this._current_state=t,e&&this._output_action[e]){var n=this._output_action[e];isFunction(n)?n.call(this.owner,i):isString(n)&&this.owner[this._output_action[e]](i)}return!0},clear:function(){this._list_of_state={},delete this._list_input,delete this._list_output,this._list_input=new Array,this._list_output=new Array,this._initial_state="";for(var t in this._inputs)for(var e=this._inputs[t],i=0;i<e.length;i++){var n=e[i][2],s=e[i][0];n.bind?n.unbind(s,this):n.addEventListener&&this.nodeUnbind(n,s)}this._current_state=""},notify:function(t){var e=this._inputs[t.src];if(e)for(var i=0;i<e.length;i++){var n=e[i][0],s=e[i][1];t.type===n&&(this._list_of_state[this._current_state]&&this.fsmNotify(s,t.data))}},getAccessibleStateOn:function(t){if(this._list_of_state[this._current_state]){var e=this._list_of_state[this._current_state].transitionEvents[t];if(e)return this._list_of_state[e.to]}},fsmNotify:function(t,e,i){if(this._list_of_state[this._current_state]){var n=this._list_of_state[this._current_state].transitionEvents[t];return!!n&&(this.goTo(n.to,n.output,{on:t,data:e},i),!0)}}},e.extendClass(U,EventSource),e.defineClassProperty(U,"initialState",{set:function(t){t?this.existState(t)&&(this._initial_state=t):this._initial_state=void 0},get:function(){return this._initial_state}});var H=function(t){this.parent=D,this.parent(t),this.constructor=H,this._headers={},this.__xhrs=[]};H.prototype={_url:"",_method:"GET",_login:"",_password:"",_content_type:"",_headers:null,__xhrs:null,destructor:function(){this.__xhrs.forEach(function(t){t&&t.onload&&t.onabort()}),this.__xhrs=null,this._headers=null,D.prototype.destructor.call(this)},setHeaders:function(t){if(t)for(var e in t)this._headers[e]=t[e]},send:function(t){var e=new XMLHttpRequest;try{this._response_text=null,this._response_xml=null,e.open(this._method,this._url,!0,this._login||null,this._password||null),e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache");for(var i in this._headers)e.setRequestHeader(i,this._headers[i]);this._headers={},this._content_type&&e.setRequestHeader("Content-Type",this._content_type);var n=this;e.onabort=function(t){e.onload=e.onerror=e.onabort=null,n.propagate("loaderror",{status:"aborted"})},e.onerror=function(t){e.onload=e.onerror=e.onabort=null,n.propagate("loaderror",{status:"failed",response:t})},e.onload=function(){e.onload=e.onerror=e.onabort=null;function t(t){return n.propagate("loaderror",t),!1}return 4!==e.readyState?t(xkr.statusText):200===e.status?(n._response_text=e.responseText,n._response_xml=e.responseXML,n.propagateChange(),n.propagate("textload",n._response_text),n._response_xml&&n.propagate("xmlload",n._response_xml),!0):t({status:e.statusText,response:e.response})},e.send(t),this.__xhrs.push(e)}catch(t){return e.onload=e.onerror=e.onabort=null,void this.propagate("loaderror",t)}}},e.extendClass(H,D),e.defineClassProperties(H,{url:{set:function(t){e.isString(t)&&(this._url=t)}},method:{set:function(t){"GET"!=t&&"POST"!=t||(this._method=t)}},login:{set:function(t){e.isString(t)&&(this._login=t)}},password:{set:function(t){e.isString(t)&&(this._password=t)}},contentType:{set:function(t){e.isString(t)&&(this._content_type=t)}},responseText:{get:function(){return this._response_text}},responseXML:{get:function(){return this._response_xml}}});var z=new D("__KEYBOARD__");z._handler_set_down=!1,z._handler_set_up=!1;z.managePrevent=function(t,e){var i,n=this.__bindings__[t];if(n)for(i=0;i<n.length;i++)if(n[i].prevent)return void e.preventDefault()},z.KEY_UP=1e3,z.ESC=27,z.ENTER=13,z.SPACE=32,z.BACKSPACE=8,z.SHIFT=16,z.CTRL=17,z.ALT=18,z.NUMLOCK=144,z.LEFT_ARROW=37,z.UP_ARROW=38,z.RIGHT_ARROW=39,z.DOWN_ARROW=40,z.L=76,z.S=83,z.Z=90,z.META=2e3,z.ANY_MASK=3e3,z.UNDO=256,z.REDO=257,z.SAVE=258,z.bind=function(t,e,i,n){var s=D.prototype.bind.call(this,t,e,i),r=this;return n&&(s.prevent=!0),t>z.KEY_UP?this._handler_set_up||(document.documentElement.addEventListener("keyup",function(t){r.managePrevent(t.keyCode,t),r.propagate(t.keyCode+z.KEY_UP,t)},!1),this._handler_set_up=!0):this._handler_set_down||(document.documentElement.addEventListener("keydown",function(t){!t.ctrlKey&&!t.metaKey||t.shiftKey||t.keyCode!==z.Z?(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.keyCode===z.Z?(r.propagate(z.REDO),t.preventDefault()):!t.ctrlKey&&!t.metaKey||t.shiftKey||t.keyCode!==z.S?(t.ctrlKey||t.metaKey)&&!t.shiftKey&&t.keyCode?(r.managePrevent(z.META+t.keyCode,t),r.propagate(z.META+t.keyCode)):(r.managePrevent(t.keyCode,t),r.propagate(t.keyCode,t)):(r.propagate(z.SAVE),t.preventDefault()):(r.propagate(z.UNDO),t.preventDefault())},!1),this._handler_set_down=!0),s};function B(t){this.parent=K,this.parent(t),this.constructor=B}B.prototype={save:function(t){var e=this;function i(t){var i,n=e.__models__[t];if(n){try{i=JSON.stringify(n)}catch(t){t.stack&&console.log(t.stack),error.log(t),e.propagate("error",t)}localStorage.setItem(t,i)}}if(t)i(t);else for(var t in this.__models__)i(t);e.propagate("save")},load:function(t){var e=this;function i(t){try{var i=e.__models__[t];if(!i)return;var n=localStorage.getItem(t);i.parseJSON(n)}catch(t){t.stack&&console.log(t.stack),console.error("LocalStorate.load failed. "+t.toString())}}if(t)i(t);else for(var t in this.__models__)i(t);e.propagate("load")}},e.extendClass(B,K);function L(t){this.parent=K,this.parent(t),this.constructor=L,this._xhrs={},this._headers={}}L.XHR=0,L.JSONP=1,L.prototype={_xhrs:null,_mode:0,_headers:null,_url:"",initComponent:function(){K.prototype.initComponent.call(this)},destructor:function(){K.prototype.destructor.call(this)},setHeaders:function(t){if(t){this._headers={};for(var e in t)this._headers[e]=t[e]}},save:function(t){var e=this;function i(t){var i,n=e.__models__[t];if(n){try{i=JSON.stringify(n)}catch(t){t.stack&&console.log(t.stack),error.log(t),e.propagate("error",t)}L.setItem(t,i)}}if(t)i(t);else for(var t in this.__models__)i(t);e.propagate("save")},load:function(t){this._mode===L.XHR&&this._load_xhr(t),this._mode===L.JSONP&&this._load_jsonp(t)},_load_xhr:function(t){var i=this;function n(t){try{var n=i.__models__[t];if(!n)return;var s=i._url+t,r=n.getModelProperties(),o=0;if(r&&r.length){s+="?";for(var a=0;a<r.length;a++){var _=r[a],h=n["_"+e.underscore(_)];"id"!==_&&"modelClass"!==_&&((e.isString(h)||e.isNumber(h))&&(o++&&(s+="&"),s+=_+"="+escape(h)))}}var c=(new HTTPRequest).init();i._xhrs[c.id]=t,c.bind("textload",i,i._process_xhr_result),c.setHeaders(i._headers),c.url=s,c.method="GET",c.contentType="application/json",c.send()}catch(t){t.stack&&console.log(t.stack),console.error("LocalStorate.load failed. "+t.toString())}}if(t)n(t);else for(var t in this.__models__)n(t)},_load_jsonp:function(t){var i=this;function n(t){try{var n=i.__models__[t];if(!n)return;var s=i._url+t+".json",r=n.getModelProperties(),o=0;if(r&&r.length){s+="?";for(var a=0;a<r.length;a++){var _=r[a],h=n["_"+e.underscore(_)];"id"!==_&&"modelClass"!==_&&((e.isString(h)||e.isNumber(h))&&(o++&&(s+="&"),s+=_+"="+escape(h)))}}var c=(new F).init();i._xhrs[c.id]=t,c.bind("jsonload",i,i._process_json_result),c.url=s,c.send()}catch(t){t.stack&&console.log(t.stack),console.error("LocalStorate.load failed. "+t.toString())}}if(t)n(t);else for(var t in this.__models__)n(t)},_sync:function(t,e,i){},_process_xhr_result:function(t){var i=t.data,n=t.src,s=this._xhrs[n.id];if(n.unbind("textload",this,this._process_xhr_result),e.free(n),delete this._xhrs[n.id],!i)return console.error("Failed to parse rss document that is null."),!1;var r=this.__models__[s];r&&(r.parseJSON(i),r.change(),this.propagate("load",r))},_process_json_result:function(t){var i=t.data,n=t.src,s=this._xhrs[n.id];n.unbind("textload",this,this._process_json_result),e.free(n),delete this._xhrs[n.id];var r=this.__models__[s];r&&(r.parseData(i),r.change(),this.propagate("load",r))}},e.extendClass(L,K),e.defineClassProperties(L,{url:{set:function(t){e.isString(t)&&(this._url=t)},get:function(t){return this._url}},mode:{set:function(t){0!==t&&1!==t||(this._mode=t)}}});function V(t){this.parent=a,this.parent(t),this.constructor=V}V.STARTED=1,V.STOPPED=0,V.PAUSED=2,V.prototype={delegate:null,_state:V.STOPPED,destructor:function(){this.stop(),a.prototype.destructor.call(this)},_clone:function(t,e){a.prototype.destructor._clone.call(this,t,e),t._state=this._state},start:function(t){},stop:function(){},pause:function(){}},e.extendClass(V,a),e.defineClassProperty(V,"state",{get:function(){return this._state}});function X(t){this.parent=V,this.parent(),this.constructor=X,this._tasksAndParams=[],this._state=V.STOPPED,arguments.length&&this.setTasks(arguments)}X.prototype={_tasksAndParams:null,_tasksWillEnded:null,setTasks:function(t){if(this._state!==V.STOPPED)return!1;var i,n,s,r;for(this._tasksAndParams=[],i=0;i<t.length;i++)(n=t[i])&&(r=null,s=null,e.isArray(n)?1===n.length?s=n[0]:2===n.length&&(s=n[0],r=n[1]):(s=n,r=null),s?s.start&&s.stop&&s.pause?this._tasksAndParams.push([s,r]):console.warn("Invalid task: "+s.toString()):console.warn("Undefined task"))},start:function(t){if(this._state===V.STARTED)return!1;this._tasksWillEnded=this._tasksAndParams.length,this._state=V.STARTED;var e,i;for(i=0;i<this._tasksAndParams.length;i++)(e=this._tasksAndParams[i])[0].delegate=this,e[0].start(e[1]?e[1]:t);return!0},stop:function(){if(this._state===V.STOPPED)return!1;this._state=V.STOPPED;var t;for(t=0;t<this._tasksAndParams.length;t++)this._tasksAndParams[t][0].stop();return!0},pause:function(){if(this._state===V.PAUSED)return!1;this._state=V.PAUSED;var t;for(t=0;t<this._tasksAndParams.length;t++)this._tasksAndParams[t][0].pause();return!0},taskDidStop:function(t){if(this._state=V.STOPPED,this._tasksWillEnded--,0===this._tasksWillEnded&&this.delegate&&this.delegate.taskDidStop)try{this.delegate.taskDidStop(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},taskDidPause:function(t){if(this._state=V.STOPPED,this._tasksWillEnded--,0===this._tasksWillEnded&&this.delegate&&this.delegate.taskDidPause)try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},taskDidEnd:function(t){if(this._state=V.STOPPED,this._tasksWillEnded--,0===this._tasksWillEnded&&this.delegate&&this.delegate.taskDidEnd)try{this.delegate.taskDidEnd(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}}},e.extendClass(X,V);function Y(t){this.parent=V,this.parent(),this.constructor=Y,this._tasksAndParams=[],this._state=V.STOPPED,arguments.length&&this.setTasks(arguments)}Y.prototype={_tasksAndParams:null,_nextTaskToStart:0,_startParam:null,setTasks:function(t){if(this._state!==V.STOPPED)return!1;var i,n,s,r;for(this._tasksAndParams=[],i=0;i<t.length;i++)(n=t[i])&&(r=null,s=null,e.isArray(n)?1===n.length?s=n[0]:2===n.length&&(s=n[0],r=n[1]):(s=n,r=null),s?s.start&&s.stop&&s.pause?this._tasksAndParams.push([s,r]):console.warn("Invalid task: "+s.toString()):console.warn("Undefined task"))},start:function(t){if(this._state===V.STARTED)return!1;var e=this._tasksAndParams[this._nextTaskToStart];return this._nextTaskToStart++,e?(this._state=V.STARTED,this._startParam=t,e[0].delegate=this,e[0].start(e[1]?e[1]:t),!0):(this._nextTaskToStart=0,this._state=V.STOPED,!1)},stop:function(){if(this._state===V.STOPPED)return!1;this._state=V.STOPPED;var t=this._tasksAndParams[this._nextTaskToStart-1];return this._nextTaskToStart=0,!!t&&(t[0].stop(),!0)},pause:function(){if(this._state===V.PAUSED)return!1;this._state=V.PAUSED;var t=this._tasksAndParams[this._nextTaskToStart-1];return!!t&&(t[0].pause(),!0)},taskDidStop:function(t){if(this._state=V.STOPPED,this._nextTaskToStart=0,this.delegate&&this.delegate.taskDidStop)try{this.delegate.taskDidStop(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},taskDidPause:function(t){if(this._state=V.PAUSED,this._nextTaskToStart=this._nextTaskToStart-1,this.delegate&&this.delegate.taskDidPause)try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},taskDidEnd:function(t){if(this._state=V.STOPPED,this._nextTaskToStart<this._tasksAndParams.length)this.start(this._startParam);else if(this._nextTaskToStart=0,this.delegate&&this.delegate.taskDidEnd)try{this.delegate.taskDidEnd(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}}},e.extendClass(Y,V);function J(t){this.parent=V,this.parent(),this.constructor=J,this._state=V.STOPPED,this.time=t}return J.prototype={_time:0,_left_time:0,_timer:null,_start_time:0,start:function(){var t=this,e=this._time;if(this._state===V.STARTED)return!1;this._state===V.PAUSED?e=this._left_time:this._left_time=e,this._state=V.STARTED,this._start_time=(new Date).getTime();t=this;return this._timer=setTimeout(function(){if(t._state=V.STOPPED,t.delegate&&t.delegate.taskDidEnd)try{t.delegate.taskDidEnd(t)}catch(t){t.stack&&console.log(t.stack),console.error(t)}},e),!0},stop:function(){if(this._state===V.STOPPED)return!1;if(this._state=V.STOPPED,clearTimeout(this._timer),this._timer=null,this._left_time=this._time,this.delegate&&this.delegate.taskDidStop)try{this.delegate.taskDidStop(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}return!0},pause:function(){if(this._state===V.PAUSED)return!1;if(this._state=V.PAUSED,this._left_time=this._left_time-(new Date).getTime()+this._start_time,this.delegate&&this.delegate.taskDidPause)try{this.delegate.taskDidPause(this)}catch(t){t.stack&&console.log(t.stack),console.error(t)}return!0}},e.extendClass(J,V),e.defineClassProperty(J,"state",{set:function(t){e.isNumber(t)&&(this._time=t)}}),t.AjaxJSONP=F,t.VSArray=M,t.createClass=I,t.Connector=j,t.Dataflow=x,t.DataStorage=K,t.DeviceConfiguration=G,t.Event=c,t.EventSource=D,t.Fsm=U,t.HTTPRequest=H,t.KEYBOARD=z,t.LocalStorage=B,t.Model=C,t.VSObject=a,t.RestStorage=L,t.scheduleAction=function(t,i){e.isFunction(t)&&(i&&e.isNumber(i)?setTimeout(t,i):i===R?e.requestAnimationFrame(t):E(t))},t.ON_NEXT_FRAME=R,t.createId=o,t.Task=V,t.Task_PAR=X,t.Task_SEQ=Y,t.TaskWait=J,t.par=function(){if(0!==arguments.length){var t=new X;return t.setTasks(arguments),t}},t.seq=function(){if(0!==arguments.length){var t=new Y;return t.setTasks(arguments),t}},t}({},vs_utils,vs_gesture);